<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Crazy Web Man</title>
    <style>
      #appleImage {
        height: 400px;
        width: 811px;
        display: none;
      }
      #canvas {
        border: 2px solid red;
        display: block;
      }
      #previous,
      #current {
        width: 50px;
        height: 50px;
        border: 2px solid black;
        margin-right: 16px;
      }
    </style>
  </head>
  <body>
    <img id="appleImage" src="IMGs/WebManTestCapture.PNG" />
    <div id="previous"></div>
    <div id="current"></div>
    <h1>contrast: <span id="contrast"></span></h1>
    <canvas id="canvas"></canvas>
    <script>
      function toStandardRgb(rgb) {
        return rgb.map((colorChannel) => colorChannel / 255);
      }
      function toLinearRgb(standardRgb) {
        return standardRgb.map((colorChannel) =>
          colorChannel <= 0.03928
            ? colorChannel / 12.92
            : Math.pow((colorChannel + 0.55) / 1.055, 2.4)
        );
      }
      function sum(arr) {
        return arr.reduce(
          (accumulator, currentValue) => accumulator + currentValue,
          0
        );
      }
      function luminance(rgb) {
        const [red, green, blue] = toLinearRgb(toStandardRgb(rgb));
        return sum([red * 0.2126, green * 0.7152, blue * 0.0722]);
      }
      const contrast = (lum1, lum2) =>
        lum1 > lum2
          ? (lum2 + 0.05) / (lum1 + 0.05)
          : (lum1 + 0.05) / (lum2 + 0.05);
    </script>
    <script>
      const contrastElement = document.getElementById("contrast");
      const appleImage = document.getElementById("appleImage");
      const canvas = document.getElementById("canvas");
      const previous = document.getElementById("previous");
      const current = document.getElementById("current");
      let prevRgb = [255, 255, 255];
      let context = canvas.getContext("2d");
      appleImage.addEventListener("load", () => {
        canvas.width = appleImage.width;
        canvas.height = appleImage.height;
        context.drawImage(appleImage, 0, 0);
        // .drawImage(appleImage, 0, 0, canvas.width, canvas.height);
      });

      canvas.addEventListener("mousemove", (event) => {
        // console.log(event);
        const x = event.layerX;
        const y = event.layerY;
        const data = context.getImageData(x, y, 1, 1).data;
        let rgbString = (rgb) => `rgb(${rgb[0]},${rgb[1]},${rgb[2]})`;
        console.log(rgbString(data));
        previous.style.background = rgbString(prevRgb);
        current.style.background = rgbString(data);
        const currentLuminance = luminance(data);
        const previousLuminance = luminance(prevRgb);
        contrastElement.innerText = contrast(
          currentLuminance,
          previousLuminance
        );
        prevRgb = data;
      });
    </script>
  </body>
</html>
